---
title: "å‡½å¼ç¨‹å¼è¨­è¨ˆ Part 6 - æ“·å– Actions ä¸­çš„ Calculations"
description: å¾å‡½å¼å…§åˆ¤æ–· Actions å’Œ calculationsï¼Œä¸¦å˜—è©¦é‡æ§‹...
date: 2025-11-30
tags: ["javascript", "fp", "functional programming", "reading note"]
published: false
language: "zh_tw"
---

ä¸Šä¸€ç¯‡ [å‡½å¼ç¨‹å¼è¨­è¨ˆ Part 5 - åˆ†è¾¨ Actions](/zh_tw/blog/functional-programming-part-5-indentify-actions-zh_tw) é€éå¯¦éš›ç¨‹å¼ç¢¼ä¾†ç·´ç¿’åˆ†è¾¨ Actionsï¼Œæ¥è‘—è¦ä¾†æ›´è¿‘ä¸€æ­¥åœ°æ“·å– Actions ä¸­çš„ Calculationsã€‚

æ›¸è£¡é€éä¸‰æ®µç¨‹å¼ç¢¼ä¾†å±•ç¤ºå¾åŸå…ˆä¸€å€‹å¤§çš„å‡½å¼å…§ä¾†åˆ†è¾¨å“ªä¸€æ®µæ˜¯å±¬æ–¼ Actionsï¼Œå“ªä¸€æ®µæ˜¯å±¬æ–¼ calculationsï¼Œæˆ– dataï¼Œå†åˆç†åœ°æ“·å–å¯ä»¥æŠ½å‡ºä½œç‚ºç´”å‡½å¼(Pure functions)ï¼Œä»¥ä¸‹æ˜¯åŸæœ¬çš„ç¨‹å¼ç¢¼ï¼š

```js
/**
 * ç¨‹å¼ç¢¼ 1: æœ¬æ®µç¨‹å¼ç¢¼ä¸»è¦å±•ç¤ºç•¶ä½¿ç”¨è€…æŠŠå•†å“åŠ å…¥åˆ°è³¼ç‰©è»Šå¾Œï¼Œå¯ä»¥åŒæ­¥çœ‹åˆ°ç¸½é‡‘é¡çš„è®ŠåŒ–
 */
const shoppingCart = [];
const shoppingCartTotal = 0;


function addItemToCart(name, price) {
  shoppingCart.push({
    name,
    price,
  });

  calcCartTotal();
}

function calcCartTotal() {
  shoppingCartTotal = 0;
  for (let i = 0; i < shoppingCart.length; i++) {
    const item = shoppingCart[i];
    shoppingCartTotal += item.price;
  }
  setCartTotalDOM(); // æ›´æ–° DOM é¡¯ç¤ºç¸½é‡‘é¡
}

/**
 * ç¨‹å¼ç¢¼ 2: è¨ˆç®—å…é‹è²»ï¼Œå¦‚æœè¶…éå…é‹è²»é–€æª»(20ç¾å…ƒ)ï¼Œä¸æ”¶å–é‹è²»
 * å¦‚æœ A å•†å“åŠ å…¥è³¼ç‰©è»Šå¾Œè¶…éé–€æª»ï¼ŒA å•†å“æœƒé¡¯ç¤º FREE çš„ logoï¼Œåä¹‹å‰‡ä¸é¡¯ç¤º
*/

function updateShippingIcons(){
  const buyButtons = getBuyButtons();
  for (let i = 0; i < buyButtons.length; i++) {
    const button = buyButtons[i];
    const item = button.item;
    if (item.price + shoppingCartTotal > 20) {
      button.showFreeShippingIcon();
    } else {
      button.hideFreeShippingIcon();
    }
  }
}

function calcCartTotal() {
  shoppingCartTotal = 0;
  for (let i = 0; i < shoppingCart.length; i++) {
    const item = shoppingCart[i];
    shoppingCartTotal += item.price;
  }
  setCartTotalDOM();
  updateShippingIcons();
  updateTaxDOM();
}

/**
 * ç¨‹å¼ç¢¼ 3: è¨ˆç®—ç¨…é‡‘
*/

function updateTaxDOM() {
  setTaxDOM(shoppingCartTotal * 0.10);
}
```

### å…ˆæ‰¾å‡º Actions, Calculations å’Œ Data

å…ˆè¤‡ç¿’ä¸€ä¸‹ Actions, Calculations å’Œ Data çš„å®šç¾©ï¼š

- Actions: æœƒç”¢ç”Ÿå‰¯ä½œç”¨(Side effect)ï¼Œæœ€å—æ™‚é–“å› ç´ å½±éŸ¿ï¼Œæœ€ä¸æ˜“æ§åˆ¶
- Calculations: èˆ‡æ™‚é–“ç„¡é—œï¼Œè¼ƒå¥½æ§åˆ¶
- Data: è¢«å‹•ä¸”éœ€è¦è¢«è§£è®€çš„å…ƒç´ ï¼Œé—œæ–¼å„ç¨®äº‹ä»¶çš„äº‹å¯¦ç´€éŒ„


```js
const shoppingCart = []; // A -> æœƒéš¨æ™‚æ”¹è®Š
const shoppingCartTotal = 0; // A -> æœƒéš¨æ™‚æ”¹è®Š


function addItemToCart(name, price) {
  shoppingCart.push({ // A -> ä¿®æ”¹å…¨åŸŸè®Šæ•¸
    name,
    price,
  });

  calcCartTotal();
}

function updateShippingIcons(){
  const buyButtons = getBuyButtons(); // A -> å–å¾— DOM å…ƒç´ 
  for (let i = 0; i < buyButtons.length; i++) {
    const button = buyButtons[i];
    const item = button.item;
    if (item.price + shoppingCartTotal > 20) {
      button.showFreeShippingIcon(); // A -> ä¿®æ”¹ DOM
    } else {
      button.hideFreeShippingIcon(); // A -> ä¿®æ”¹ DOM
    }
  }
}

function updateTaxDOM() {
  setTaxDOM(shoppingCartTotal * 0.10); // A -> ä¿®æ”¹ DOM
}

function calcCartTotal() {
  shoppingCartTotal = 0; // A -> ä¿®æ”¹å…¨åŸŸè®Šæ•¸
  for (let i = 0; i < shoppingCart.length; i++) {
    const item = shoppingCart[i];
    shoppingCartTotal += item.price;
  }
  setCartTotalDOM();
  updateShippingIcons();
  updateTaxDOM();
}
```

åŸºæœ¬ä¸Šå…¨éƒ¨éƒ½å±¬æ–¼ Actionsï¼Œå› ç‚ºåªè¦ä¸€å€‹å‡½å¼å…§æœ‰ Actionsï¼Œæ•´å€‹å‡½å¼å°±æœƒæˆç‚º Actions ğŸ˜…

### å‡½å¼çš„è¼¸å…¥èˆ‡è¼¸å‡º

å‡½å¼çš„è¼¸å…¥å’Œè¼¸å‡ºæœ‰åˆ†**é¡¯æ€§(explicit input and output)** è·Ÿ**éš±æ€§(implicit input and output)**ï¼Œåˆç¨±**å‰¯ä½œç”¨(Side effect)**ï¼Œé‚£é€™äº›éš±æ€§è·Ÿé¡¯æ€§çš„è¼¸å…¥å’Œè¼¸å‡ºæœ‰ä»€éº¼å·®åˆ¥å‘¢ï¼Ÿ

  é¡¯æ€§è¼¸å…¥å’Œè¼¸å‡ºï¼ŒæŒ‡å¾—æ˜¯**å‚³å…¥çš„å¼•æ•¸(arguments)**å’Œ**å›å‚³çš„å€¼(return value)**ï¼Œå…¶é¤˜çš„çš†ç‚ºéš±æ€§è¼¸å…¥å’Œè¼¸å‡ºï¼Œä¾‹å¦‚ï¼š

```js
function addToTotal(amount) {
  console.log(amount);
  total += amount;
  return total;
}
```

ä¸Šé¢ç¨‹å¼ç¢¼çš„å¼•æ•¸(arguments)æ˜¯ `amount`ï¼Œå›å‚³çš„å€¼(return value)æ˜¯ `total`ï¼Œé€™å…©è€…å°±æ˜¯é¡¯æ€§è¼¸å…¥å’Œè¼¸å‡ºã€‚å¦å¤– `console.log(amount)` å’Œ `total += amount` å°±æ˜¯éš±æ€§è¼¸å…¥å’Œè¼¸å‡ºï¼Œå› ç‚ºå®ƒä¸æ˜¯æ˜ç¢ºçš„è¼¸å…¥å’Œè¼¸å‡ºï¼Œè€Œæ˜¯é¡å¤–çš„è¡Œç‚ºã€‚
è€Œä¸€å€‹å‡½å¼å…§è‹¥åªæœ‰é¡¯æ€§è¼¸å…¥å’Œè¼¸å‡ºï¼Œå‰‡ç¨±ç‚ºç´”å‡½å¼(Pure function)ï¼Œåä¹‹å‰‡ç¨±ç‚ºéç´”å‡½å¼(Impure function)ã€‚

### æ”¹å¯«ä¸Šè¿°ç¨‹å¼ç¢¼

```js
/**
 * æ”¹å¯«å‰ ========================================================
*/
function calcCartTotal() {
  shoppingCartTotal = 0;
  for (let i = 0; i < shoppingCart.length; i++) {
    const item = shoppingCart[i];
    shoppingCartTotal += item.price;
  }
  setCartTotalDOM();
  updateShippingIcons();
  updateTaxDOM();
}

/**
 * æ”¹å¯«å¾Œ v1 ========================================================
*/

// ä»ç‚º Actions
function calcTotal() {
  shoppingCartTotal = 0; // è¼¸å‡º
  for (let i = 0; i < shoppingCart.length; i++) { // shoppingCart.length è¼¸å…¥
    const item = shoppingCart[i];
    shoppingCartTotal += item.price; // è¼¸å‡º
  }
}

function calcCartTotal() {
  calcTotal();
  setCartTotalDOM();
  updateShippingIcons();
  updateTaxDOM();
}

/**
 * æ”¹å¯«å¾Œ v2 ========================================================
*/

function calcTotal(cart) {
  let total = 0; // æŠŠå…¨åŸŸè®Šæ•¸æ”¹ç‚ºå€åŸŸè®Šæ•¸
  for (let i = 0; i < cart.length; i++) { // å°‡ cart ä½œç‚ºå¼•æ•¸å‚³å…¥ï¼Œä¸ä½¿ç”¨å…¨åŸŸè®Šæ•¸
    const item = cart[i];
    total += item.price;
  }
  return total; // å›å‚³å€åŸŸè®Šæ•¸
}

function calcCartTotal() {
  shoppingCartTotal = calcTotal(shoppingCart);
  setCartTotalDOM();
  updateShippingIcons();
  updateTaxDOM();
}
```

å¦å¤–ä¸€æ®µç¨‹å¼ç¢¼çš„æ”¹å¯«ï¼š

```js
/**
 * æ”¹å¯«å‰ ========================================================
*/
function addItemToCart(name, price) {
  shoppingCart.push({
    name,
    price,
  });
  calcCartTotal();
}

/**
 * æ”¹å¯«å¾Œ v1 ========================================================
*/

function addItem (cart, name, price) {
  cart.push({ // ç”¨ cart ä½œç‚ºå¼•æ•¸å‚³å…¥ï¼Œä¸ä½¿ç”¨å…¨åŸŸè®Šæ•¸ï¼Œä½†é€™é‚Šçš„ push æœƒæ›´æ”¹å…¨åŸŸçš„é™£åˆ—
    name,
    price,
  });
}

function addItemToCart(name, price) {
  addItem(shoppingCart, name, price); 
  calcCartTotal();
}

/**
 * æ”¹å¯«å¾Œ v2 ========================================================
*/

function addItem (cart, name, price) {
  const newCart = [...cart]; // æˆ– const newCart = cart.slice(); 
  newCart.push({
    name,
    price,
  });
  return newCart;
}

function addItemToCart(name, price) {
  shoppingCart = addItem(shoppingCart, name, price); 
  calcCartTotal();
}
```

> ä¸å¯è®Šæ€§(Immutability)çš„å¯¦ä½œæ–¹æ³•ä¹‹ã„§æ˜¯ï¼Œå¯«å…¥æ™‚è¤‡è£½(Copy-on-write)ï¼Œé€™é‚Šçš„å¯«å…¥æ™‚æŒ‡çš„æ˜¯å‡½å¼å…§çš„å¯«å…¥ï¼Œè€Œä¸æ˜¯å…¨åŸŸçš„å¯«å…¥ã€‚

### æ¸¬è©¦ä¸Šè¿°çš„ Calculations

```js
function calcTotal(cart) {
  let total = 0;
  for (let i = 0; i < cart.length; i++) {
    const item = cart[i];
    total += item.price;
  }
  return total;
}

console.log(calcTotal([{ price: 10 }, { price: 20 }])); // æ°¸é å›å‚³ç›¸åŒçš„çµæœ 30
console.log(calcTotal([{ price: 10 }, { price: 20 }, { price: 30 }])); // æ°¸é å›å‚³ç›¸åŒçš„çµæœ 60

function addItem(cart, name, price) {
  cart.push({
    name,
    price,
  });
}

console.log(addItem([{ price: 10 }, { price: 20 }], 'apple', 10)); // æ°¸é å›å‚³ç›¸åŒçš„çµæœ [{ price: 10 }, { price: 20 }, { name: 'apple', price: 10 }]
console.log(addItem([{ price: 10 }, { price: 20 }], 'banana', 20)); // æ°¸é å›å‚³ç›¸åŒçš„çµæœ [{ price: 10 }, { price: 20 }, { name: 'banana', price: 20 }]
```

### å¾ Actions ä¸­æ“·å– Calculations çš„æ­¥é©Ÿï¼š

- æ‰¾å‡ºä¸¦åˆ†é›¢è·Ÿè¨ˆç®—æœ‰é—œçš„ç¨‹å¼ç¢¼
- æ‰¾å‡ºå‡½å¼å…§é¡¯æ€§è·Ÿéš±æ€§çš„è¼¸å‡ºè·Ÿè¼¸å…¥
- è¬›éš±æ€§è¼¸å…¥æ›æˆå¼•æ•¸è¼¸å…¥ï¼Œéš±æ€§è¼¸å‡ºè½‰æ›ç‚ºå›å‚³å€¼